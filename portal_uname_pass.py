#!/usr/bin/env python2

import sys
import re

# requires a file to read in with the data from

# bash command to grab data
# for i in `ls *.pcap`; do ngrep -I $i|egrep "<WebsDBSchName>websdb_security_LEETECH<\/WebsDBSchName>"|sort|uniq;done
# redirect the output to a file then use that file as the input for this script"

f = open(sys.argv[1], 'rb')
x = f.readlines()

def find_users_passwords(x):
    for user in x:
        users = user.split(">")[0]
        passwords = user.split("<![CDATA")[1]
        matchpassword = re.search(r'.*', passwords)
        matchusername = re.search(r'[CDATA].*',users)
        if matchpassword and matchusername:
           print "\t"
           print "Username: %s" % matchusername.group().split("[")[1].replace("]",'')
           print "Password: %s" % matchpassword.group().split("[")[1].replace("]",'').split(">")[0]
           #print "\n"
        else:
           print "we're dead jim!!!"

find_users_passwords(x)
